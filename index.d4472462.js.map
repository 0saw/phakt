{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["const WIDTH = 100\nconst HEIGHT = 100\nconst PIECES_X = 3\nconst PIECES_Y = 3\n\nconst HALF_WIDTH = WIDTH / 2\nconst HALF_HEIGHT = HEIGHT / 2\nconst IMAGE_WIDTH = WIDTH * PIECES_X\nconst IMAGE_HEIGHT = HEIGHT * PIECES_Y\n\nconst getPiece = (src: string, x: number, y: number): HTMLDivElement => {\n  const piece = document.createElement('div')\n\n  piece.className = 'piece'\n  piece.style.cssText = `\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: ${WIDTH}px;\n    height: ${HEIGHT}px;\n    background-image: url(${src});\n    background-position: ${-1 * WIDTH * x}px ${-1 * HEIGHT * y}px;\n    background-size: ${PIECES_X * 100}% ${PIECES_Y * 100}%;\n    transform: translate(0, 0);\n    pointer-events: none;\n  `\n\n  return piece\n}\n\nconst distance = (\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number\n): number => {\n  return ((x1 - x2) ** 2 + (y1 - y2) ** 2) ** 0.5\n}\n\nlet zIndex = 1\n\nvoid (async () => {\n  const game = document.querySelector<HTMLDivElement>('.game')\n  const gameArea = document.querySelector<HTMLDivElement>('.game__area')\n  const bag = document.querySelector<HTMLDivElement>('.game__bag')\n\n  if (game === null || gameArea === null || bag === null) {\n    return\n  }\n\n  gameArea.style.width = `${PIECES_X * WIDTH}px`\n  gameArea.style.height = `${PIECES_Y * HEIGHT}px`\n\n  const pieces = new Array<HTMLDivElement>()\n  for (let y = 0; y < PIECES_Y; y++) {\n    for (let x = 0; x < PIECES_X; x++) {\n      pieces.push(getPiece(`${process.env.RANDOM_IMAGE_SERVICE}/${IMAGE_WIDTH}/${IMAGE_HEIGHT}`, x, y))\n    }\n  }\n\n  const placedPieces = new Array<HTMLDivElement | null>(pieces.length).fill(null)\n  const piecesBag = [...pieces]\n  piecesBag.sort(() => 0.5 - Math.random())\n  bag.innerText = `x${piecesBag.length}`\n\n  game.addEventListener('pointerdown', (e) => {\n    let piece: HTMLDivElement\n    let grabOffsetX = -HALF_WIDTH\n    let grabOffsetY = -HALF_HEIGHT\n    const bagRect = bag.getBoundingClientRect()\n    const gameAreaRect = gameArea.getBoundingClientRect()\n    const isInBag = (x: number, y: number): boolean => x >= bagRect.left && x <= bagRect.right && y >= bagRect.top && y <= bagRect.bottom\n\n    if (e.target instanceof HTMLDivElement && e.target.classList.contains('piece')) {\n      piece = e.target\n      grabOffsetX = -e.offsetX\n      grabOffsetY = -e.offsetY\n\n      if (placedPieces.includes(piece)) {\n        placedPieces[placedPieces.indexOf(piece)] = null\n      }\n    } else {\n      if (e.target !== bag) {\n        return\n      }\n\n      const nextPiece = piecesBag.pop()\n      bag.innerText = `x${piecesBag.length}`\n\n      if (typeof nextPiece !== 'undefined') {\n        piece = nextPiece\n        game.append(nextPiece)\n      } else {\n        return\n      }\n    }\n\n    piece.style.zIndex = `${zIndex++}`\n\n    const update = (e: PointerEvent): void => {\n      bag.classList.toggle('game__bag--active', isInBag(e.x, e.y))\n\n      piece.style.transform = `translate(${Math.min(window.innerWidth - WIDTH, Math.max(0, e.x + grabOffsetX))}px, ${Math.min(window.innerHeight - HEIGHT, Math.max(0, e.y + grabOffsetY))}px)`\n    }\n    update(e)\n\n    const stop = (e: PointerEvent): void => {\n      e.stopPropagation()\n      e.stopImmediatePropagation()\n      game.removeEventListener('pointermove', update)\n      game.removeEventListener('pointerout', onPointerOutStop)\n      game.removeEventListener('pointerup', stop)\n\n      const isMouseInBag = isInBag(e.x, e.y)\n\n      piece.style.pointerEvents = isMouseInBag ? 'none' : ''\n\n      if (isMouseInBag) {\n        piecesBag.unshift(piece)\n        piece.remove()\n\n        bag.classList.remove('game__bag--active')\n      }\n      bag.innerText = `x${piecesBag.length}`\n\n      const centerX = e.x + grabOffsetX + HALF_WIDTH - gameAreaRect.x\n      const centerY = e.y + grabOffsetY + HALF_WIDTH - gameAreaRect.y\n      const areaX = Math.floor(centerX / gameAreaRect.width * PIECES_X)\n      const areaY = Math.floor(centerY / gameAreaRect.height * PIECES_Y)\n\n      if (\n        placedPieces[areaY * PIECES_Y + areaX] === null &&\n          centerX >= 0 && centerX <= gameAreaRect.width && centerY >= 0 && centerY <= gameAreaRect.height &&\n          distance(\n            areaX * WIDTH + HALF_WIDTH,\n            areaY * HEIGHT + HALF_HEIGHT,\n            centerX,\n            centerY\n          ) < 24\n      ) {\n        placedPieces[areaY * PIECES_Y + areaX] = piece\n        piece.style.transform = `translate(${gameAreaRect.left + areaX * WIDTH}px, ${gameAreaRect.top + areaY * HEIGHT}px)`\n      }\n\n      if (placedPieces.every((piece, index) => pieces[index] === piece)) {\n        setTimeout(() => alert('Win, lmao'), 10)\n      }\n\n      grabOffsetX = -HALF_WIDTH\n      grabOffsetY = -HALF_HEIGHT\n    }\n\n    const onPointerOutStop = (e: PointerEvent): void => {\n      if (e.relatedTarget === document.documentElement) {\n        stop(e)\n      }\n    }\n\n    game.addEventListener('pointermove', update)\n    game.addEventListener('pointerout', onPointerOutStop)\n    game.addEventListener('pointerup', stop)\n  })\n})()\n\nexport {}\n"],"names":["$559c39b934b932c4$var$WIDTH","$559c39b934b932c4$var$HEIGHT","$559c39b934b932c4$var$getPiece","src","x","y","piece","document","createElement","className","style","cssText","$559c39b934b932c4$var$zIndex","game","querySelector","gameArea","bag","width","height","pieces","Array","push","placedPieces","length","fill","piecesBag","sort","Math","random","innerText","addEventListener","e","grabOffsetX","grabOffsetY","bagRect","getBoundingClientRect","gameAreaRect","isInBag","left","right","top","bottom","target","HTMLDivElement","classList","contains","offsetX","offsetY","includes","indexOf","nextPiece","pop","append","zIndex","update","toggle","transform","min","window","innerWidth","max","innerHeight","stop","stopPropagation","stopImmediatePropagation","removeEventListener","onPointerOutStop","isMouseInBag","pointerEvents","unshift","remove","centerX","centerY","areaX","floor","areaY","every","index","setTimeout","alert","relatedTarget","documentElement"],"version":3,"file":"index.d4472462.js.map"}